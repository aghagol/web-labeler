<html>
<head></head>
<body>
    <input type='file' onchange='openFile(event)'><br>
    <iframe id='iframe'
        width='1000'
        height='1000'
        src='about:blank'>
    </iframe><br>
    <input type='button' value='Next' onClick='loadNextPage()'>
    <input type='button' value='Prev' onClick='loadPrevPage()'>
    <input type='button' value='Save' onClick='saveWork()'><br>
    <input type='button' value='Label as 1' onClick='markLabel(1)'>
    <input type='button' value='Label as 2' onClick='markLabel(2)'>
    <input type='button' value='Label as 3' onClick='markLabel(3)'>
    <input type='button' value='Label as 4' onClick='markLabel(4)'>
    <script>
        var fs = require('fs');
        var webpageLinks;
        var currentIndex = -1;
        var labels = {};
        var openFile = function(event) {
            var input = event.target;
            var reader = new FileReader();
            reader.onload = function(){
                var text = reader.result;
                webpageLinks = text.split('\n');
            };
            reader.readAsText(input.files[0]);
            alert('Found ' + webpageLinks.length + ' entries');
            alert('Click Next to begin labeling');
            currentIndex = -1;
        };
        var node = document.getElementById('iframe');
        var loadNextPage = function() {
            if (currentIndex < webpageLinks.length - 1) {
                currentIndex++;
                node.src = webpageLinks[currentIndex];
            } else {
                alert('Reached end of the list!');
                currentIndex = webpageLinks.length;
            }
        };
        var loadPrevPage = function() {
            if (currentIndex <= 0) {
                alert('At top of the list!');
            } else {
                currentIndex--;
                node.src = webpageLinks[currentIndex];
            }
        };
        var saveWork = function() {

            var labelsfilepath = '/home/mo/github/web-labeler/labels.txt';
            var labelsfile = fs.openSync(labelsfilepath, 'w');
            // labelsfile.open('w');
            for (var key in labels) {
                // labelsfile.write(labels[key] + '\t' + key + '\n');
                fs.writeSync(labelsfile, labels[key] + '\t' + key + '\n');
            }
            // labelsfile.close();
            alert('Saved work at ' + labelsfilepath);
        };
        var markLabel = function(val) {
            labels[webpageLinks[currentIndex]] = val;
        };
    </script>
</body>
</html>
